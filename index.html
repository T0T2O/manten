<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>割合テスト完全攻略</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #fdf6e3; padding: 20px; }
        .box { background: white; max-width: 480px; margin: 0 auto; padding: 20px; border-radius: 15px; border-top: 8px solid #e67e22; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn { padding: 15px; width: 100%; background: #e67e22; color: white; border: none; border-radius: 30px; font-size: 1.1rem; cursor: pointer; margin-top: 10px; font-weight: bold; }
        input { font-size: 1.5rem; width: 140px; padding: 10px; margin: 10px; border: 2px solid #e67e22; border-radius: 10px; text-align: center; }
        .q-card { background: #fff9f0; padding: 20px; border-radius: 10px; margin: 15px 0; font-size: 1.1rem; line-height: 1.6; border-left: 5px solid #e67e22; text-align: left; }
        .step-info { color: #e67e22; font-weight: bold; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="box" id="main-view">
    <h2 style="color:#d35400;">割合テスト完全攻略編</h2>
    <p>テストの全パターンをマスターしよう！</p>
    <button class="btn" onclick="start()">特訓スタート！</button>
</div>

<script>
let score = 0; let count = 0; let currentQ = {};

// テストプリントの内容に基づいた問題生成
function getQuestion() {
    const r = Math.random();
    // 1-3問：百分率の基本、4-7問：3公式、8-10問：文章題応用
    if (count < 3) {
        const p = [8, 30, 46.2, 80, 150, 400][Math.floor(Math.random()*6)];
        return r > 0.5 ? { s:"基本", t:`割合 <b>${(p/100).toFixed(3).replace(/\.?0+$/, "")}</b> を<br>百分率（％）になおすと？`, a:p, u:"%" } 
                       : { s:"基本", t:`<b>${p}%</b> を<br>割合（小数）になおすと？`, a:p/100, u:"" };
    } else if (count < 7) {
        const type = Math.floor(Math.random()*3);
        if(type==0) {
            const b = [120, 200, 500][Math.floor(Math.random()*3)];
            const p = [30, 40, 75][Math.floor(Math.random()*3)];
            return { s:"計算", t:`<b>${b}g</b> の <b>${p}%</b> は何g？`, a: b*p/100, u:"g" };
        } else if(type==1) {
            return { s:"計算", t:`<b>21人</b> は <b>15人</b> の何％？`, a:140, u:"%" };
        } else {
            return { s:"計算", t:`<b>18L</b> が <b>90%</b> にあたるとき、<br>もとの体積は何L？`, a:20, u:"L" };
        }
    } else {
        const type = Math.floor(Math.random()*3);
        if(type==0) {
            const b = [2500, 3000, 1500][Math.floor(Math.random()*3)];
            return { s:"応用", t:`仕入れ値 <b>${b}円</b> に <b>20%</b> の利益をのせた売値は何円？`, a: b*1.2, u:"円" };
        } else if(type==1) {
            const b = [40, 50, 60][Math.floor(Math.random()*3)];
            return { s:"応用", t:`定員 <b>${b}人</b> の <b>130%</b> の希望者が来た。何人？`, a: b*1.3, u:"人" };
        } else {
            return { s:"応用", t:`<b>72ページ</b> 読んだ。これは全体の <b>60%</b>。全部で何ページ？`, a:120, u:"ページ" };
        }
    }
}

function start() { score = 0; count = 0; next(); }

function next() {
    currentQ = getQuestion();
    document.getElementById("main-view").innerHTML = `
        <span class="step-info">ステップ：${currentQ.s}</span>
        <p>第 ${count + 1} / 10 問</p>
        <div class="q-card">${currentQ.t}</div>
        <input type="number" id="ans" step="0.001" autofocus> ${currentQ.u}<br>
        <button class="btn" onclick="check()">答え合わせ</button>
    `;
    document.getElementById("ans").focus();
}

function check() {
    const val = parseFloat(document.getElementById("ans").value);
    if (isNaN(val)) return;
    const isCorrect = Math.abs(val - currentQ.a) < 0.01;
    if (isCorrect) score++;

    document.getElementById("main-view").innerHTML += `
        <div style="margin-top:15px; color:${isCorrect?'#27ae60':'#c0392b'}; font-weight:bold;">
            ${isCorrect ? '✨ 正解！' : '❌ ざんねん… 正解は ' + currentQ.a}
        </div>
    `;
    
    count++;
    const btnText = count < 10 ? "つぎの問題へ" : "結果を見る";
    const func = count < 10 ? "next()" : "showResult()";
    document.getElementById("main-view").innerHTML += `<button class="btn" onclick="${func}">${btnText}</button>`;
}

function showResult() {
    document.getElementById("main-view").innerHTML = `
        <h2>しゅうりょう！</h2>
        <div style="font-size:3rem; color:#e67e22; margin:20px 0;">${score} <span style="font-size:1.2rem;">/ 10</span></div>
        <p>${score === 10 ? '完璧！君は割合マスターだ！' : '間違えた問題をもう一度解いてみよう！'}</p>
        <button class="btn" onclick="location.reload()">もう一度挑戦</button>
    `;
}
</script>
</body>
</html>
